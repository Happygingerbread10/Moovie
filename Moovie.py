import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium

# 1. μν™”κ΄€ λ”λ―Έ λ°μ΄ν„° (μ„μΉ ν¬ν•¨)
data = [
    {"λ„": "μ„μΈνΉλ³„μ‹", "μν™”κ΄€": "CGV κ°•λ‚¨", "μ„λ„": 37.501, "κ²½λ„": 127.026, "μν™”": "λ²”μ£„λ„μ‹4", "μ‹κ°„": "14:30", "μΆμ„": 12},
    {"λ„": "μ„μΈνΉλ³„μ‹", "μν™”κ΄€": "λ΅―λ°μ‹λ„¤λ§ μ›”λ“νƒ€μ›", "μ„λ„": 37.513, "κ²½λ„": 127.104, "μν™”": "ν“¨λ¦¬μ¤μ‚¬", "μ‹κ°„": "15:20", "μΆμ„": 24},
    {"λ„": "κ²½κΈ°λ„", "μν™”κ΄€": "CGV μμ›", "μ„λ„": 37.266, "κ²½λ„": 127.000, "μν™”": "μΏµν‘Έν¬λ”4", "μ‹κ°„": "13:45", "μΆμ„": 10},
    {"λ„": "κ°•μ›λ„", "μν™”κ΄€": "λ©”κ°€λ°•μ¤ μ›μ£Ό", "μ„λ„": 37.342, "κ²½λ„": 127.933, "μν™”": "λ²”μ£„λ„μ‹4", "μ‹κ°„": "16:10", "μΆμ„": 15},
    {"λ„": "μ „λΌλ¶λ„", "μν™”κ΄€": "λ΅―λ°μ‹λ„¤λ§ μ „μ£Ό", "μ„λ„": 35.823, "κ²½λ„": 127.147, "μν™”": "ν“¨λ¦¬μ¤μ‚¬", "μ‹κ°„": "13:10", "μΆμ„": 8},
    {"λ„": "κ²½μƒλ‚¨λ„", "μν™”κ΄€": "CGV μ°½μ›", "μ„λ„": 35.228, "κ²½λ„": 128.681, "μν™”": "μΏµν‘Έν¬λ”4", "μ‹κ°„": "17:40", "μΆμ„": 20},
    {"λ„": "μ μ£ΌνΉλ³„μμΉλ„", "μν™”κ΄€": "λ©”κ°€λ°•μ¤ μ μ£Ό", "μ„λ„": 33.500, "κ²½λ„": 126.531, "μν™”": "λ²”μ£„λ„μ‹4", "μ‹κ°„": "14:50", "μΆμ„": 14},
    {"λ„": "μ„ΈμΆ…νΉλ³„μμΉμ‹", "μν™”κ΄€": "CGV μ„ΈμΆ…", "μ„λ„": 36.480, "κ²½λ„": 127.288, "μν™”": "ν“¨λ¦¬μ¤μ‚¬", "μ‹κ°„": "17:10", "μΆμ„": 20},
]

df = pd.DataFrame(data)

# 2. Streamlit μ„¤μ •
st.set_page_config(page_title="π¥ μν™” μƒμ μ •λ³΄", layout="wide")
st.title("π¬ λ€ν•λ―Όκµ­ 8λ„ μ§€μ—­λ³„ μν™” μƒμ μ •λ³΄")

# 3. μ§€μ—­ μ„ νƒ
regions = df['λ„'].unique()
selected_region = st.selectbox("μ§€μ—­μ„ μ„ νƒν•μ„Έμ”", sorted(regions))

# 4. ν•΄λ‹Ή μ§€μ—­μ μν™” λ©λ΅ μ¶”μ¶
region_df = df[df['λ„'] == selected_region]
available_movies = region_df['μν™”'].unique()
selected_movie = st.selectbox("μƒμ μ¤‘μΈ μν™”λ¥Ό μ„ νƒν•μ„Έμ”", available_movies)

# 5. μν™”κ΄€ ν•„ν„°λ§
filtered = region_df[region_df['μν™”'] == selected_movie]

# 6. μ§€λ„ μƒμ„±
if not filtered.empty:
    avg_lat = filtered['μ„λ„'].mean()
    avg_lon = filtered['κ²½λ„'].mean()
    m = folium.Map(location=[avg_lat, avg_lon], zoom_start=11)

    for _, row in filtered.iterrows():
        popup = f"""
        <b>{row['μν™”κ΄€']}</b><br>
        μƒμ μ‹κ°„: {row['μ‹κ°„']}<br>
        λ‚¨μ€ μΆμ„: {row['μΆμ„']}μ„
        """
        folium.Marker(
            location=[row['μ„λ„'], row['κ²½λ„']],
            tooltip=row['μν™”κ΄€'],
            popup=popup
        ).add_to(m)

    st.subheader("π—ΊοΈ μν™”κ΄€ μ„μΉ")
    st_folium(m, width=800, height=500)

    # 7. κ°€μ¥ λΉ λ¥Έ μƒμ μ‹κ°„ ν‘μ‹
    earliest = filtered.sort_values(by='μ‹κ°„').iloc[0]
    st.success(
        f"ποΈ **κ°€μ¥ λΉ λ¥Έ μƒμ**: {earliest['μν™”κ΄€']} β€” {earliest['μ‹κ°„']} / λ‚¨μ€ μΆμ„: {earliest['μΆμ„']}μ„"
    )
else:
    st.warning("μ΄ μ§€μ—­μ—μ„ ν•΄λ‹Ή μν™”λ¥Ό μƒμν•λ” μν™”κ΄€μ΄ μ—†μµλ‹λ‹¤.")
